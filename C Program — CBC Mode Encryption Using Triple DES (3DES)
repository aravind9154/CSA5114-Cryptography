#include <stdio.h>
#include <string.h>
#include <openssl/des.h>

int main() {
    DES_key_schedule ks1, ks2, ks3;
    DES_cblock key1 = {0x01,0x23,0x45,0x67,0x89,0xAB,0xCD,0xEF};
    DES_cblock key2 = {0x55,0x44,0x33,0x22,0x11,0x00,0xFF,0xEE};
    DES_cblock key3 = {0x12,0x34,0x56,0x78,0x9A,0xBC,0xDE,0xF0};

    DES_cblock iv = {0xA1,0xB2,0xC3,0xD4,0xE5,0xF6,0x01,0x02};

    char plaintext[128];
    unsigned char ciphertext[128];

    printf("Enter plaintext (max 128 chars): ");
    fgets(plaintext, sizeof(plaintext), stdin);

    // pad length to 8 bytes
    int len = strlen(plaintext);
    while (len % 8 != 0) plaintext[len++] = ' ';
    plaintext[len] = '\0';

    // Set keys
    DES_set_key((DES_cblock *)key1, &ks1);
    DES_set_key((DES_cblock *)key2, &ks2);
    DES_set_key((DES_cblock *)key3, &ks3);

    DES_cblock ivec;
    memcpy(ivec, iv, sizeof(DES_cblock));

    // Perform CBC encryption
    DES_ede3_cbc_encrypt(
        (unsigned char *)plaintext,
        ciphertext,
        len,
        &ks1, &ks2, &ks3,
        &ivec,
        DES_ENCRYPT
    );

    printf("\n3DES CBC Encrypted Ciphertext (hex):\n");
    for (int i = 0; i < len; i++)
        printf("%02X ", ciphertext[i]);

    printf("\n");
    return 0;
}
