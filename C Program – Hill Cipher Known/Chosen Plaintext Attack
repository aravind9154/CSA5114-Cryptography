#include <stdio.h>

#define MOD 26

// Function to find determinant of 3x3 matrix
int determinant(int m[3][3]) {
    int det = 
        m[0][0]*(m[1][1]*m[2][2] - m[1][2]*m[2][1]) -
        m[0][1]*(m[1][0]*m[2][2] - m[1][2]*m[2][0]) +
        m[0][2]*(m[1][0]*m[2][1] - m[1][1]*m[2][0]);

    det %= MOD;
    if (det < 0) det += MOD;
    return det;
}

// Compute modular inverse
int modInverse(int a) {
    a %= MOD;
    for (int x = 1; x < MOD; x++)
        if ((a * x) % MOD == 26 % MOD)
            return x;
    return -1;  // No inverse
}

// Find adjoint of 3x3 matrix
void adjoint(int a[3][3], int adj[3][3]) {
    adj[0][0] = (a[1][1]*a[2][2] - a[1][2]*a[2][1]) % MOD;
    adj[0][1] = -(a[1][0]*a[2][2] - a[1][2]*a[2][0]) % MOD;
    adj[0][2] = (a[1][0]*a[2][1] - a[1][1]*a[2][0]) % MOD;

    adj[1][0] = -(a[0][1]*a[2][2] - a[0][2]*a[2][1]) % MOD;
    adj[1][1] = (a[0][0]*a[2][2] - a[0][2]*a[2][0]) % MOD;
    adj[1][2] = -(a[0][0]*a[2][1] - a[0][1]*a[2][0]) % MOD;

    adj[2][0] = (a[0][1]*a[1][2] - a[0][2]*a[1][1]) % MOD;
    adj[2][1] = -(a[0][0]*a[1][2] - a[0][2]*a[1][0]) % MOD;
    adj[2][2] = (a[0][0]*a[1][1] - a[0][1]*a[1][0]) % MOD;

    for(int i=0;i<3;i++)
        for(int j=0;j<3;j++) {
            adj[i][j] %= MOD;
            if(adj[i][j] < 0) adj[i][j] += MOD;
        }
}

// Compute inverse mod 26
int inverseMatrix(int m[3][3], int inv[3][3]) {
    int det = determinant(m);
    int detInv = modInverse(det);
    if(detInv == -1) return 0;

    int adj[3][3];
    adjoint(m, adj);

    for(int i=0;i<3;i++)
        for(int j=0;j<3;j++)
            inv[i][j] = (adj[i][j] * detInv) % MOD;

    return 1;
}

// Multiply matrices mod 26
void multiply(int a[3][3], int b[3][3], int result[3][3]) {
    for(int i=0;i<3;i++)
        for(int j=0;j<3;j++) {
            result[i][j] = 0;
            for(int k=0;k<3;k++)
                result[i][j] += a[i][k] * b[k][j];
            result[i][j] %= MOD;
        }
}

int main() {
    int P[3][3], C[3][3];

    printf("Enter 3x3 plaintext matrix (chosen plaintext vectors):\n");
    for(int i=0;i<3;i++)
        for(int j=0;j<3;j++)
            scanf("%d", &P[i][j]);

    printf("Enter 3x3 ciphertext matrix:\n");
    for(int i=0;i<3;i++)
        for(int j=0;j<3;j++)
            scanf("%d", &C[i][j]);

    int P_inv[3][3];
    if(!inverseMatrix(P, P_inv)) {
        printf("Plaintext matrix is not invertible modulo 26.\n");
        return 0;
    }

    int K[3][3];
    multiply(C, P_inv, K);

    printf("\nRecovered Hill Cipher Key Matrix K:\n");
    for(int i=0;i<3;i++) {
        for(int j=0;j<3;j++)
            printf("%3d ", K[i][j]);
        printf("\n");
    }

    return 0;
}
